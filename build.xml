<?xml version="1.0" encoding="UTF-8"?>

<project name="GF Java" default="buildeverything" basedir=".">

    <property name="version" value="20120203"/>
    <property name="libs" value="lib/json_simple-1.1.jar;lib/httpcore-4.1.1.jar;lib/httpclient-4.1.1.jar;lib/commons-lang-2.2.jar;lib/commons-logging-1.1.jar"/>
    <property name="jar" value="gf-java.jar"/>
    <property name="classes" location="bin/"/>
    <property name="test_src" location="test/"/>
    <property name="test_report" location="test_report/"/>

    <target name="compile"
            description="Compile the Java files">
        <mkdir dir="${classes}"/>
        <javac
        	target="1.5"
        	includeantruntime="false"
            srcdir="src/"
        	excludes="**/test/**"
            classpath="${libs}"
            destdir="${classes}"
        />
    </target>

    <target name="jar"
            description="Create JAR files"
            depends="compile">
        <jar
            destfile="${jar}"
            basedir="${classes}"
        />
    </target>

    <target name="doc"
            description="Create the Javadoc files">
         <javadoc
             sourcepath="src/"
             packagenames="*"
        	 excludepackagenames="**.test"
             destdir="docs/"
             extdirs="lib/"
             windowtitle="GF Java, version ${version}"
             doctitle="GF Java, version ${version}"
             overview="src/overview.html"
             linksource="on">
            <bottom><![CDATA[<em>Copyright 2008-2012, Attempto Group, University of Zurich (see <a href="http://attempto.ifi.uzh.ch" target="_blank">http://attempto.ifi.uzh.ch</a>)</em>]]></bottom>
        </javadoc>
    </target>

    <target name="clean"
            description="Clean up">
        <delete file="${jar}"/>
        <delete dir="${classes}/"/>
        <delete dir="docs/"/>
    </target>

    <target name="buildeverything"
            depends="clean, jar, doc"
            description="Clean up, create JAR files and create Javadoc"
    />

    <target name="test" depends="compile" description="Unit test">
        <javac srcdir="${test_src}" destdir="${classes}">
            <classpath>
                <fileset dir="lib" >
                    <include name="*.jar" />
                </fileset>
                <pathelement location="${classes}"/>
            </classpath>
        </javac>
        <mkdir dir="${test_report}"/>
        <junit printsummary="yes" haltonfailure="no" fork="on">
            <classpath>
                <fileset dir="lib" >
                    <include name="*.jar" />
                </fileset>
                <pathelement location="${classes}"/>
            </classpath>
            <formatter type="plain"/>
            <batchtest fork="yes" todir="${test_report}">
                <fileset dir="${test_src}">
                    <include name="**/*Test.java"/>
                </fileset>
            </batchtest>
        </junit>
    </target>
</project>
